<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Reports Analyzer - Cat CKD Assistant</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
         :root {
            /* Dark Theme Color System */
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-tertiary: #111111;
            --bg-card: #1a1a1a;
            --bg-input: #1f1f1f;
            --bg-hover: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-tertiary: #666666;
            --text-muted: #404040;
            --accent-primary: #ff6b35;
            --accent-secondary: #e55a2b;
            --accent-tertiary: #cc4a24;
            --success: #00ff88;
            --error: #ff4757;
            --warning: #ffa502;
            --border-primary: #333333;
            --border-secondary: #404040;
            --border-accent: #ff6b35;
            /* Typography */
            --font-family: 'Tomato Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            /* Spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            --space-3xl: 4rem;
            /* Shadows */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);
            --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.6);
            --shadow-glow: 0 0 20px rgba(255, 107, 53, 0.3);
            /* Border Radius */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --radius-full: 9999px;
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-family);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }
        /* Animated Background */
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(255, 107, 53, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255, 107, 53, 0.05) 0%, transparent 50%), radial-gradient(circle at 40% 40%, rgba(255, 107, 53, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-lg);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        /* Header */
        
        .header {
            text-align: center;
            margin-bottom: var(--space-xl);
            padding: var(--space-lg) 0;
            position: relative;
        }
        
        .logo {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: var(--radius-xl);
            margin-bottom: var(--space-md);
            box-shadow: var(--shadow-glow);
            position: relative;
            overflow: hidden;
            transition: all var(--transition-normal);
        }
        
        .logo:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }
        
        .logo::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.2) 50%, transparent 70%);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }
        
        .logo-icon {
            font-size: 2rem;
            color: white;
            z-index: 1;
            position: relative;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }
        
        .header h1 {
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-xs);
            letter-spacing: -0.025em;
        }
        
        .header .subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 400;
            max-width: 400px;
            margin: 0 auto;
        }
        /* Main Content */
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
        }
        /* Upload Interface */
        
        .upload-container {
            background: var(--bg-card);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            width: 100%;
            border: 1px solid var(--border-primary);
            margin-bottom: var(--space-2xl);
            position: relative;
        }
        
        .upload-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-primary), transparent);
        }
        
        .upload-header {
            background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
            color: var(--text-primary);
            padding: var(--space-lg);
            text-align: center;
            border-bottom: 1px solid var(--border-primary);
        }
        
        .upload-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: var(--space-xs);
            color: var(--accent-primary);
        }
        
        .upload-header p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .upload-body {
            padding: var(--space-xl);
        }
        /* Upload Area */
        
        .upload-area {
            border: 2px dashed var(--border-primary);
            padding: var(--space-3xl);
            text-align: center;
            margin-bottom: var(--space-xl);
            border-radius: var(--radius-xl);
            background: var(--bg-input);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }
        
        .upload-area.dragover {
            border-color: var(--accent-primary);
            background: var(--bg-hover);
            box-shadow: var(--shadow-glow);
        }
        
        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-primary), transparent);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: var(--accent-primary);
            margin-bottom: var(--space-md);
            display: block;
        }
        
        .upload-text {
            font-size: 1.125rem;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
            font-weight: 500;
        }
        
        .upload-subtext {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: var(--space-lg);
        }
        
        .upload-btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: var(--space-md) var(--space-xl);
            border: none;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all var(--transition-normal);
            box-shadow: var(--shadow-md);
        }
        
        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg), var(--shadow-glow);
        }
        
        input[type="file"] {
            display: none;
        }
        /* Preview Area */
        
        .preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }
        
        .preview-item {
            position: relative;
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border-primary);
            transition: all var(--transition-normal);
        }
        
        .preview-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .preview-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }
        
        .remove-btn {
            position: absolute;
            top: var(--space-xs);
            right: var(--space-xs);
            background: var(--error);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-normal);
        }
        
        .remove-btn:hover {
            background: #ff3333;
            transform: scale(1.1);
        }
        
        .file-info {
            padding: var(--space-sm);
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
            word-break: break-word;
        }
        /* Question Input */
        
        .question-section {
            margin-bottom: var(--space-xl);
        }
        
        .question-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
        }
        
        .question-input {
            width: 100%;
            padding: var(--space-lg);
            font-size: 1rem;
            border: 2px solid var(--border-primary);
            border-radius: var(--radius-lg);
            outline: none;
            transition: all var(--transition-normal);
            background: var(--bg-input);
            color: var(--text-primary);
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
        }
        
        .question-input:focus {
            border-color: var(--accent-primary);
            background: var(--bg-hover);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }
        
        .question-input::placeholder {
            color: var(--text-tertiary);
        }
        /* Action Buttons */
        
        .action-buttons {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .analyze-btn {
            padding: var(--space-lg) var(--space-xl);
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all var(--transition-normal);
            box-shadow: var(--shadow-md);
            min-width: 160px;
        }
        
        .analyze-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg), var(--shadow-glow);
        }
        
        .analyze-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .clear-btn {
            padding: var(--space-lg) var(--space-xl);
            background: var(--bg-card);
            color: var(--text-secondary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all var(--transition-normal);
            min-width: 120px;
        }
        
        .clear-btn:hover {
            background: var(--bg-hover);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }
        /* Response Area */
        
        .response-area {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            border: 1px solid var(--border-primary);
            position: relative;
            display: none;
        }
        
        .response-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-primary), transparent);
        }
        
        .response-content {
            font-size: 1rem;
            line-height: 1.7;
            color: var(--text-primary);
            white-space: pre-wrap;
        }
        
        .response-content.loading {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-primary);
            font-weight: 500;
        }
        
        .loading-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .loading-dots {
            display: flex;
            gap: 6px;
        }
        
        .loading-dots span {
            width: 10px;
            height: 10px;
            background: var(--accent-primary);
            border-radius: 50%;
            animation: pulse 1.4s ease-in-out infinite both;
        }
        
        .loading-dots span:nth-child(1) {
            animation-delay: -0.32s;
        }
        
        .loading-dots span:nth-child(2) {
            animation-delay: -0.16s;
        }
        
        @keyframes pulse {
            0%,
            80%,
            100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .response-content.error {
            color: var(--error);
            background: rgba(255, 71, 87, 0.1);
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--error);
        }
        
        .response-content.success {
            color: var(--text-primary);
            background: var(--bg-primary);
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--accent-primary);
        }
        /* Navigation */
        
        .nav-section {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: var(--space-xl);
        }
        
        .nav-button {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-lg);
            background: var(--bg-card);
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius-lg);
            font-weight: 500;
            font-size: 0.875rem;
            transition: all var(--transition-normal);
            border: 1px solid var(--border-primary);
            box-shadow: var(--shadow-sm);
        }
        
        .nav-button:hover {
            background: var(--bg-hover);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }
        
        .nav-button:active {
            transform: translateY(0);
        }
        /* Footer */
        
        .footer {
            text-align: center;
            padding: var(--space-xl) 0;
            color: var(--text-tertiary);
            font-size: 0.875rem;
            margin-top: auto;
            border-top: 1px solid var(--border-primary);
        }
        
        .footer-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
        }
        /* Responsive Design */
        
        @media (max-width: 768px) {
            .container {
                padding: var(--space-md);
            }
            .upload-area {
                padding: var(--space-xl);
            }
            .preview-container {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            .analyze-btn,
            .clear-btn {
                width: 100%;
                max-width: 300px;
            }
            .nav-section {
                flex-direction: column;
                align-items: center;
            }
            .nav-button {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .upload-body {
                padding: var(--space-lg);
            }
            .upload-header {
                padding: var(--space-lg);
            }
            .response-area {
                padding: var(--space-lg);
            }
        }
        /* Accessibility */
        
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        /* Focus styles for keyboard navigation */
        
        .analyze-btn:focus-visible,
        .clear-btn:focus-visible,
        .question-input:focus-visible,
        .nav-button:focus-visible {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }
        /* Custom scrollbar */
        
         ::-webkit-scrollbar {
            width: 8px;
        }
        
         ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }
        
         ::-webkit-scrollbar-thumb {
            background: var(--border-primary);
            border-radius: var(--radius-full);
        }
        
         ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">🐱</span>
            </div>
            <h1>Medical Reports Analyzer</h1>
            <p class="subtitle">Upload multiple CKD medical reports for comprehensive analysis and insights</p>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Upload Interface -->
            <div class="upload-container">
                <div class="upload-header">
                    <h2>Upload Medical Reports</h2>
                    <p>Drag and drop multiple CKD report images or click to select files</p>
                </div>

                <div class="upload-body">
                    <div class="upload-area" id="uploadArea">
                        <span class="upload-icon">📄</span>
                        <div class="upload-text">Drag & Drop Medical Reports</div>
                        <div class="upload-subtext">or click to browse files</div>
                        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                            Choose Files
                        </button>
                        <input type="file" id="fileInput" accept="image/*" multiple onchange="handleFileSelect(event)">
                    </div>

                    <div id="imagePreview" class="preview-container"></div>

                    <div class="question-section">
                        <label for="question" class="question-label">Your question about the reports:</label>
                        <textarea id="question" class="question-input" placeholder="e.g., Please analyze these CKD reports and compare the kidney function values across all reports. What trends do you see?">Please analyze these feline CKD medical reports and provide comprehensive insights.</textarea>
                    </div>

                    <div class="action-buttons">
                        <button class="analyze-btn" onclick="analyzeMultipleImages()" id="analyzeButton">
                            🔍 Analyze All Reports
                        </button>
                        <button class="clear-btn" onclick="clearImages()">
                            ️ Clear All Images
                        </button>
                    </div>
                </div>
            </div>

            <!-- Response Area -->
            <div id="response" class="response-area">
                <div class="response-content" id="result">
                    Ready to analyze your medical reports.
                </div>
            </div>

            <!-- Navigation -->
            <nav class="nav-section">
                <a href="/" class="nav-button">
                    <span>🏠</span> Back to Chat
                </a>
                <a href="#" class="nav-button" onclick="showInfo()">
                    <span>ℹ️</span> About Report Analysis
                </a>
            </nav>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <span>⚠️</span>
                <span>This tool provides general information and should not replace professional veterinary advice. Always consult with your veterinarian for specific medical guidance.</span>
            </div>
        </footer>
    </div>

    <script>
        let selectedFiles = [];
        let updatePreviewCallCount = 0;
        
        // DOM Elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const imagePreview = document.getElementById('imagePreview');
        const question = document.getElementById('question');
        const analyzeButton = document.getElementById('analyzeButton');
        const response = document.getElementById('response');
        const result = document.getElementById('result');
        
        // Drag and drop functionality
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            console.log('Drop event:', files.length, 'files');
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    handleFile(file);
                }
            });
        });
        
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            console.log('File input selected:', files.length, 'files');
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    handleFile(file);
                }
            });
            // Clear the input to allow selecting the same file again
            event.target.value = '';
        }
        
        function handleFile(file) {
            console.log('Handling file:', file.name, file.size);
            
            // Check if file is already selected
            const existingFile = selectedFiles.find(f => f.name === file.name && f.size === file.size);
            if (existingFile) {
                console.log('File already exists:', file.name);
                showError('This file is already selected!');
                return;
            }
            
            console.log('Adding new file:', file.name);
            selectedFiles.push(file);
            updatePreview();
            updateAnalyzeButton();
        }
        
        function updatePreview() {
            updatePreviewCallCount++;
            console.log(`updatePreview called ${updatePreviewCallCount} times`);
            
            // Clear the preview container first
            imagePreview.innerHTML = '';
            
            // Add debugging
            console.log('Updating preview with', selectedFiles.length, 'files');
            selectedFiles.forEach((file, index) => {
                console.log(`File ${index}: ${file.name} (${file.size} bytes)`);
            });
            
            // Create all preview items synchronously
            selectedFiles.forEach((file, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                
                // Create the image element
                const img = document.createElement('img');
                img.className = 'preview-image';
                img.alt = 'Preview';
                
                // Create the remove button
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.textContent = '×';
                removeBtn.onclick = function() {
                    removeImageByFile(file.name, file.size);
                };
                
                // Create the file info div
                const fileInfo = document.createElement('div');
                fileInfo.className = 'file-info';
                fileInfo.textContent = file.name;
                
                // Assemble the preview item
                previewItem.appendChild(img);
                previewItem.appendChild(removeBtn);
                previewItem.appendChild(fileInfo);
                
                // Add to container
                imagePreview.appendChild(previewItem);
                
                // Load the image
                const reader = new FileReader();
                reader.onload = function(e) {
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }
        
        function removeImage(index) {
            selectedFiles.splice(index, 1);
            updatePreview();
            updateAnalyzeButton();
        }
        
        function removeImageByFile(fileName, fileSize) {
            const index = selectedFiles.findIndex(f => f.name === fileName && f.size === fileSize);
            if (index !== -1) {
                selectedFiles.splice(index, 1);
                updatePreview();
                updateAnalyzeButton();
            }
        }
        
        function clearImages() {
            selectedFiles = [];
            updatePreviewCallCount = 0;
            updatePreview();
            updateAnalyzeButton();
            hideResponse();
        }
        
        function updateAnalyzeButton() {
            analyzeButton.disabled = selectedFiles.length === 0;
            if (selectedFiles.length === 0) {
                analyzeButton.textContent = '🔍 Analyze All Reports';
            } else {
                analyzeButton.textContent = ` Analyze ${selectedFiles.length} Report${selectedFiles.length > 1 ? 's' : ''}`;
            }
        }
        
        function showLoadingMessage() {
            response.style.display = 'block';
            result.className = 'response-content loading';
            result.innerHTML = `
                <div class="loading-indicator">
                    <span>Analyzing ${selectedFiles.length} medical report${selectedFiles.length > 1 ? 's' : ''}</span>
                    <div class="loading-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
        }
        
        function showResult(message) {
            response.style.display = 'block';
            result.className = 'response-content success';
            result.textContent = message;
        }
        
        function showError(message) {
            response.style.display = 'block';
            result.className = 'response-content error';
            result.textContent = message;
        }
        
        function hideResponse() {
            response.style.display = 'none';
        }
        
        async function analyzeMultipleImages() {
            if (selectedFiles.length === 0) {
                showError('Please select at least one image!');
                return;
            }
            
            const questionText = question.value.trim();
            if (!questionText) {
                showError('Please enter a question about the reports.');
                return;
            }
            
            // Show loading state
            analyzeButton.disabled = true;
            showLoadingMessage();
            
            const formData = new FormData();
            selectedFiles.forEach(file => {
                formData.append('images', file);
            });
            formData.append('question', questionText);
            
            try {
                const response = await fetch('/analyze-multiple-reports', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult(data.response);
                } else {
                    showError(`Error: ${data.error}`);
                }
            } catch (error) {
                console.error('Error:', error);
                showError('I\'m having trouble analyzing the reports right now. Please check your connection and try again.');
            } finally {
                analyzeButton.disabled = false;
                updateAnalyzeButton();
            }
        }
        
        // Info function
        function showInfo() {
            alert('This tool can analyze multiple CKD medical reports simultaneously. Upload images of lab results, blood work, or other medical documents related to your cat\'s kidney health. The AI will provide comprehensive analysis and insights.');
        }
        
        // Initialize
        updateAnalyzeButton();
        hideResponse();
        
        // Add smooth scrolling for better UX
        document.documentElement.style.scrollBehavior = 'smooth';
    </script>
</body>

</html> 
            <!-- Upload Interface 